<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Space Blaster</title>
    <style>
        body {
            background: #071021;
            color: #fff;
            font-family: Inter, Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        canvas {
            background: linear-gradient(180deg,#071021,#0f1a2b);
            border: 2px solid #19f0ff;
            border-radius: 12px;
            margin-top: 32px;
            box-shadow: 0 8px 32px #000a;
        }
        .controls {
            margin-top: 18px;
            color: #7cff7c;
            font-size: 1rem;
        }
        .back {
            margin-top: 24px;
            font-weight: bold;
            padding: 10px 18px;
            border-radius: 10px;
            background: linear-gradient(180deg, #172433, #0f1b2a);
            border: none;
            color: #dff7f2;
            font-size: 17px;
            box-shadow: 0 4px 16px rgba(2,8,20,0.18);
            transition: background 0.2s, color 0.2s, transform 0.2s;
            display: inline-block;
            cursor: pointer;
            text-decoration: none;
        }
        .back:hover {
            background: linear-gradient(180deg, #59d3c5, #0f1b2a);
            color: #fff;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1>üéØ Space Blaster</h1>
    <div class="controls">
        Fl√®ches ou WASD = bouger<br>
        Espace = tirer
    </div>
    <canvas id="game" width="480" height="640"></canvas>
    <div id="bestScore" style="margin-top:10px;color:#19f0ff;font-weight:bold;font-size:1.1rem;"></div>
    <div class="back" onclick="window.location.href='../index.html'">‚Üê Retour au hub</div>
    <script>
        // --- Space Blaster: simple arcade shooter ---
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const bestScoreDiv = document.getElementById('bestScore');

        // Game objects
        let ship = { x: canvas.width/2, y: canvas.height-60, w: 60, h: 60, vx:0, vy:0 };
        let bullets = [];
        let meteors = [];
        let keys = {};
        let score = 0;
        let gameOver = false;
        let meteorSpeed = 2;
        let lastMeteor = 0;
        let bestScore = Number(localStorage.getItem('spaceBlasterBest')) || 0;

        function updateBestScoreDisplay() {
            bestScoreDiv.textContent = "Meilleur score : " + bestScore;
        }
        updateBestScoreDisplay();

        // Controls
        document.addEventListener('keydown', e => {
            keys[e.key.toLowerCase()] = true;
            if(e.code === 'Space') shoot();
        });
        document.addEventListener('keyup', e => {
            keys[e.key.toLowerCase()] = false;
        });

        function shoot() {
            if (gameOver) return;
            bullets.push({ x: ship.x, y: ship.y-18, vy: -8 });
        }

        function spawnMeteor() {
            const size = 32 + Math.random()*24;
            meteors.push({
                x: Math.random()*(canvas.width-size),
                y: -size,
                r: size/2,
                vy: meteorSpeed + (score/100) + Math.random()*1.5
            });
        }

        function update() {
            if (gameOver) return;
            // Ship movement
            ship.vx = ship.vy = 0;
            if(keys['arrowleft']||keys['a']) ship.vx = -5;
            if(keys['arrowright']||keys['d']) ship.vx = 5;
            if(keys['arrowup']||keys['w']) ship.vy = -5;
            if(keys['arrowdown']||keys['s']) ship.vy = 5;
            ship.x += ship.vx;
            ship.y += ship.vy;
            ship.x = Math.max(ship.w/2, Math.min(canvas.width-ship.w/2, ship.x));
            ship.y = Math.max(ship.h/2, Math.min(canvas.height-ship.h/2, ship.y));

            // Bullets
            bullets.forEach(b=>b.y+=b.vy);
            bullets = bullets.filter(b=>b.y>-20);

            // Meteors
            meteors.forEach(m=>m.y+=m.vy);
            meteors = meteors.filter(m=>m.y<canvas.height+40);

            // Collisions: bullet-meteor
            for(let i=meteors.length-1;i>=0;i--){
                for(let j=bullets.length-1;j>=0;j--){
                    let m=meteors[i],b=bullets[j];
                    if(Math.hypot(m.x+m.r-b.x,b.y-m.y-m.r)<m.r){
                        meteors.splice(i,1);
                        bullets.splice(j,1);
                        score+=10;
                        // Met √† jour le meilleur score si besoin
                        if(score > bestScore){
                            bestScore = score;
                            localStorage.setItem('spaceBlasterBest', bestScore);
                            updateBestScoreDisplay();
                        }
                        break;
                    }
                }
            }
            // Collisions: ship-meteor
            for(let m of meteors){
                if(Math.abs(m.x+m.r-ship.x)<m.r+ship.w/2 && Math.abs(m.y+m.r-ship.y)<m.r+ship.h/2){
                    gameOver = true;
                }
            }

            // Meteor speed increases over time
            meteorSpeed += 0.0008;

            // Spawn meteors
            if(Date.now()-lastMeteor > 700-Math.min(500,meteorSpeed*50)){
                spawnMeteor();
                lastMeteor = Date.now();
            }
        }

        // Charger l'image du vaisseau
        const shipImg = new Image();
        shipImg.src = "../images/spaceship.png";

        function drawShip(x, y) {
            // Dessine l'image centr√©e sur (x, y)
            ctx.save();
            ctx.translate(x, y);
            ctx.drawImage(shipImg, -ship.w/2, -ship.h/2, ship.w, ship.h);
            ctx.restore();
        }

        function drawMeteor(m){
            ctx.save();
            ctx.beginPath();
            ctx.arc(m.x+m.r,m.y+m.r,m.r,0,2*Math.PI);
            ctx.fillStyle="#888";
            ctx.shadowColor="#ff4fcc";
            ctx.shadowBlur=8;
            ctx.fill();
            ctx.strokeStyle="#19f0ff";
            ctx.lineWidth=2;
            ctx.stroke();
            ctx.restore();
        }

        function drawBullet(b){
            ctx.save();
            ctx.beginPath();
            ctx.arc(b.x,b.y,4,0,2*Math.PI);
            ctx.fillStyle="#7cff7c";
            ctx.shadowColor="#19f0ff";
            ctx.shadowBlur=6;
            ctx.fill();
            ctx.restore();
        }

        function render() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            // Draw ship
            drawShip(ship.x,ship.y);
            // Draw bullets
            bullets.forEach(drawBullet);
            // Draw meteors
            meteors.forEach(drawMeteor);
            // Score
            ctx.fillStyle="#fff";
            ctx.font="20px Inter";
            ctx.fillText("Score: "+score,20,32);
            ctx.fillStyle="#19f0ff";
            ctx.font="16px Inter";
            ctx.fillText("Meilleur: "+bestScore,20,54);
            if(gameOver){
                ctx.fillStyle="#ff4fcc";
                ctx.font="32px Inter";
                ctx.fillText("GAME OVER",canvas.width/2-100,canvas.height/2);
                ctx.font="18px Inter";
                ctx.fillText("Appuie sur Entr√©e pour recommencer",canvas.width/2-140,canvas.height/2+32);
            }
        }

        function loop() {
            update();
            render();
            requestAnimationFrame(loop);
        }

        document.addEventListener('keydown',e=>{
            if(gameOver && e.code==="Enter"){
                // Restart
                ship = { x: canvas.width/2, y: canvas.height-60, w: 60, h: 60, vx:0, vy:0 };
                bullets = [];
                meteors = [];
                score = 0;
                meteorSpeed = 2;
                gameOver = false;
                lastMeteor = Date.now();
                updateBestScoreDisplay();
            }
        });

        // Start game
        lastMeteor = Date.now();
        loop();
    </script>
</body>
</html>