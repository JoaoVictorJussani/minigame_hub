<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capybara Runner</title>
<style>
:root {
  --bg: #0b1020;
  --card: #0f1724;
  --accent: #59d3c5;
  --muted: #95a3b8;
}
body {
  margin:0;
  font-family: Inter, Arial, sans-serif;
  background: linear-gradient(180deg, #071021 0%, #071527 60%);
  color: #e6f0f4;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100%;
  padding: 24px;
}
h1 {
  margin-top: 20px;
  text-align:center;
  font-size:2.2rem;
  color: var(--accent);
  text-shadow: 0 2px 12px #071021;
  letter-spacing: 1px;
}
canvas {
  background: linear-gradient(180deg, rgba(12, 18, 30, 0.6), rgba(6, 10, 18, 0.6));
  margin-top:20px;
  border:2.5px solid var(--accent);
  border-radius:14px;
  box-shadow: 0 8px 30px rgba(2,8,20,0.7);
  display:block;
}
.controls {
  margin-top:18px;
  display:flex;
  gap:12px;
  align-items:center;
}
button {
  padding:10px 18px;
  font-weight:bold;
  border:none;
  border-radius:10px;
  cursor:pointer;
  background: linear-gradient(180deg, #172433, #0f1b2a);
  color: #dff7f2;
  font-size:17px;
  box-shadow: 0 4px 16px rgba(2,8,20,0.18);
  transition: background 0.2s, transform 0.2s;
}
button:hover { background: linear-gradient(180deg, #59d3c5, #0f1b2a); color:#fff; transform:scale(1.05);}
.scoreboard {
  margin-top:14px;
  font-size:20px;
  color:var(--accent);
  font-weight:600;
  background:rgba(12,18,30,0.6);
  padding:8px 18px;
  border-radius:10px;
  box-shadow:0 2px 8px rgba(2,8,20,0.12);
  display: flex;
  justify-content: space-between;
}
@media (max-width:700px){
  body {padding:8px;}
  canvas{width:340px !important;height:180px !important;}
  h1{font-size:1.4rem;}
}
</style>
</head>
<body>
<h1>üèÉ Capybara Runner</h1>
<canvas id="game" width="800" height="200"></canvas>
<div class="controls">
  <button onclick="voltarHub()">‚¨Ö Retour au Hub</button>
</div>
<div class="scoreboard" id="scoreboard">
  Score: <span id="scoreVal">0</span> ‚Äî Meilleur: <span id="bestVal">0</span>
</div>
<script>
// image du capybara
const capyImg = new Image();
capyImg.src = "../images/capybara.png"; // le fichier doit √™tre dans images/

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// scores
let score = 0;
let bestScore = parseInt(localStorage.getItem("capybaraBest") || "0",10);

document.getElementById("scoreVal").textContent = score;
document.getElementById("bestVal").textContent = bestScore;

let gameOverFlag = false;

// joueur - capybara
const player = {
  x:50,
  y:150,
  width: 60,  
  height:60,
  vy:0,
  gravity:1.2,
  jumpPower:-18,
  onGround:true
};

// obstacles
let obstacles = [];
let spawnTimer = 0;
let baseSpeed = 6; // vitesse initiale

// input
let keys = {};
window.addEventListener('keydown', e => { keys[e.code] = true; if(e.code==='Space' || e.code==='ArrowUp'){ jump(); }});
window.addEventListener('keyup', e => { keys[e.code] = false; });

function jump(){
  if(player.onGround){
    player.vy = player.jumpPower;
    player.onGround = false;
  }
}

function spawnObstacle(){
  const height = 30 + Math.random()*40;
  obstacles.push({
    x: canvas.width,
    y: 200-height,
    width:20,
    height:height
  });
}

function update(){
  if(gameOverFlag) return;

  // physique du joueur
  player.vy += player.gravity;
  player.y += player.vy;

  if(player.y + player.height > 200){
    player.y = 200 - player.height;
    player.vy = 0;
    player.onGround = true;
  }

  // spawn obstacles
  spawnTimer++;
  let spawnInterval = Math.max(90 - Math.floor(score/5)*5, 30); // intervalle diminue avec le score
  if(spawnTimer > spawnInterval){
    spawnObstacle();
    spawnTimer = 0;
  }

  // d√©placer les obstacles et collision
  for(let i=obstacles.length-1;i>=0;i--){
    let currentSpeed = baseSpeed + Math.floor(score/5); // vitesse augmente avec le score
    obstacles[i].x -= currentSpeed;

    // collision
    if(player.x < obstacles[i].x + obstacles[i].width &&
       player.x + player.width > obstacles[i].x &&
       player.y < obstacles[i].y + obstacles[i].height &&
       player.y + player.height > obstacles[i].y){
         gameOver();
       }

    // passer obstacle
    if(obstacles[i].x + obstacles[i].width < 0){
      obstacles.splice(i,1);
      score++;
      if(score > bestScore){
        bestScore = score;
        localStorage.setItem("capybaraBest", bestScore);
      }
    }
  }
  document.getElementById("scoreVal").textContent = score;
  document.getElementById("bestVal").textContent = bestScore;
}

function gameOver(){
  gameOverFlag = true;
  alert("üíÄ Partie termin√©e ! Score : " + score + " | Meilleur : " + bestScore);
  location.reload();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // sol am√©lior√©
  ctx.save();
  ctx.fillStyle = "#654321";
  ctx.shadowColor = "#000";
  ctx.shadowBlur = 12;
  ctx.fillRect(0,200,canvas.width,14);
  ctx.restore();

  // capybara
  ctx.drawImage(capyImg, player.x, player.y, player.width, player.height);

  // obstacles
  ctx.fillStyle="#59d3c5";
  obstacles.forEach(o => {
    ctx.save();
    ctx.shadowColor = "#19f0ff";
    ctx.shadowBlur = 8;
    ctx.fillRect(o.x,o.y,o.width,o.height);
    ctx.restore();
  });

  // score affich√© en haut √† droite
  ctx.save();
  ctx.font="bold 22px Inter, Arial";
  ctx.fillStyle= "#59d3c5";
  ctx.textAlign="right";
  ctx.fillText("Score: "+score,canvas.width-18,32);
  ctx.fillStyle="#95a3b8";
  ctx.font="16px Inter, Arial";
  ctx.fillText("Meilleur: "+bestScore,canvas.width-18,54);
  ctx.restore();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

function voltarHub(){ window.location.href='../index.html'; }

loop();
</script>
</body>
</html>
